<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Você está offline - AbaetéFest</title>
  
  <!-- Meta tags essenciais -->
  <meta name="description" content="Você está sem conexão. Verifique sua internet e tente novamente.">
  <meta name="robots" content="noindex, nofollow">
  
  <!-- PWA Meta tags -->
  <meta name="theme-color" content="#151933">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="128x128" href="/icons/icon-128x128.png">
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
  
  <!-- CSS inline para garantir que funcione offline -->
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #151933 0%, #1e2147 100%);
      color: #ffffff;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      text-align: center;
    }
    
    .offline-container {
      max-width: 400px;
      width: 100%;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 40px 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .offline-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 30px;
      background: #75fbcf;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: pulse 2s infinite;
    }
    
    .offline-icon svg {
      width: 40px;
      height: 40px;
      fill: #151933;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .offline-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 15px;
      color: #ffffff;
    }
    
    .offline-description {
      font-size: 16px;
      line-height: 1.5;
      margin-bottom: 30px;
      color: rgba(255, 255, 255, 0.8);
    }
    
    .offline-actions {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.3s ease;
    }
    
    .btn-primary {
      background: #75fbcf;
      color: #151933;
    }
    
    .btn-primary:hover {
      background: #5ec4a8;
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }
    
    .offline-tips {
      margin-top: 30px;
      text-align: left;
    }
    
    .offline-tips h3 {
      font-size: 18px;
      margin-bottom: 15px;
      color: #75fbcf;
    }
    
    .offline-tips ul {
      list-style: none;
      padding: 0;
    }
    
    .offline-tips li {
      padding: 8px 0;
      color: rgba(255, 255, 255, 0.7);
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .offline-tips li::before {
      content: '•';
      color: #75fbcf;
      font-weight: bold;
      font-size: 16px;
    }
    
    .connection-status {
      margin-top: 20px;
      padding: 10px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
    }
    
    .connection-status.online {
      background: rgba(33, 186, 69, 0.2);
      color: #21BA45;
      border: 1px solid rgba(33, 186, 69, 0.3);
    }
    
    .connection-status.offline {
      background: rgba(193, 0, 21, 0.2);
      color: #C10015;
      border: 1px solid rgba(193, 0, 21, 0.3);
    }
    
    @media (max-width: 480px) {
      .offline-container {
        padding: 30px 20px;
        margin: 20px;
      }
      
      .offline-title {
        font-size: 20px;
      }
      
      .offline-description {
        font-size: 14px;
      }
      
      .btn {
        padding: 10px 20px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="offline-container">
    <!-- Ícone WiFi off -->
    <div class="offline-icon">
      <svg viewBox="0 0 24 24">
        <path d="M21,9L22.5,7.5C21.75,6.75 15.54,1.88 12,1.88S2.25,6.75 1.5,7.5L3,9C3.75,8.25 8.46,4.62 12,4.62S20.25,8.25 21,9M19.5,10.5L21,12C20.25,12.75 16.54,15.38 12,15.38C10.81,15.38 9.56,15.1 8.37,14.63L9.8,13.2C10.5,13.32 11.22,13.38 12,13.38C14.46,13.38 17.25,11.75 19.5,10.5M3,12L1.5,10.5C2.25,9.75 4.46,8.12 7.37,7.37L8.8,8.8C6.22,9.32 4.5,10.5 3,12M12,20.5A1.5,1.5 0 0,1 10.5,19A1.5,1.5 0 0,1 12,17.5A1.5,1.5 0 0,1 13.5,19A1.5,1.5 0 0,1 12,20.5Z"/>
      </svg>
    </div>
    
    <h1 class="offline-title">Você está offline</h1>
    <p class="offline-description">
      Não foi possível conectar com o AbaetéFest. Verifique sua conexão com a internet e tente novamente.
    </p>
    
    <div class="offline-actions">
      <button class="btn btn-primary" onclick="tryReconnect()">
        <svg width="16" height="16" viewBox="0 0 24 24">
          <path fill="currentColor" d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
        </svg>
        Tentar novamente
      </button>
      
      <button class="btn btn-secondary" onclick="goOfflineMode()">
        <svg width="16" height="16" viewBox="0 0 24 24">
          <path fill="currentColor" d="M12,3C7.03,3 3,7.03 3,12C3,16.97 7.03,21 12,21C16.97,21 21,16.97 21,12C21,7.03 16.97,3 12,3M16.5,16.25L11.5,11.25V7H13V10.25L17,14.25L16.5,16.25Z"/>
        </svg>
        Ver eventos salvos
      </button>
    </div>
    
    <!-- Status da conexão -->
    <div id="connectionStatus" class="connection-status">
      <span id="statusText"></span>
    </div>
    
    <!-- Dicas -->
    <div class="offline-tips">
      <h3>Dicas para reconectar:</h3>
      <ul>
        <li>Verifique se o WiFi está ligado</li>
        <li>Teste sua conexão de dados móveis</li>
        <li>Tente se aproximar do roteador</li>
        <li>Reinicie seu roteador se necessário</li>
      </ul>
    </div>
  </div>

  <script>
    // === MONITORAMENTO DE CONEXÃO ===
    const connectionStatus = document.getElementById('connectionStatus')
    const statusText = document.getElementById('statusText')
    
    function updateConnectionStatus() {
      const isOnline = navigator.onLine
      
      if (isOnline) {
        connectionStatus.className = 'connection-status online'
        connectionStatus.style.display = 'block'
        statusText.textContent = '✓ Conexão restaurada! Clique em "Tentar novamente"'
      } else {
        connectionStatus.className = 'connection-status offline'
        connectionStatus.style.display = 'block'
        statusText.textContent = '✗ Ainda sem conexão'
      }
    }
    
    // Monitora mudanças na conexão
    window.addEventListener('online', updateConnectionStatus)
    window.addEventListener('offline', updateConnectionStatus)
    
    // Verifica status inicial
    updateConnectionStatus()
    
    // === FUNCÕES DE INTERAÇÃO ===
    function tryReconnect() {
      // Mostra loading
      const btn = event.target
      const originalText = btn.innerHTML
      btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" style="animation: spin 1s linear infinite;"><path fill="currentColor" d="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"/></svg> Conectando...'
      btn.disabled = true
      
      // Tenta recarregar a página
      setTimeout(() => {
        window.location.reload()
      }, 1000)
    }
    
    function goOfflineMode() {
      // Tenta abrir dados cached ou página principal
      if ('serviceWorker' in navigator) {
        // Envia mensagem para o SW buscar dados cached
        navigator.serviceWorker.ready.then(registration => {
          if (registration.active) {
            registration.active.postMessage({
              action: 'GET_CACHED_EVENTS'
            })
          }
        })
        
        // Aguarda resposta por 2 segundos, depois redireciona
        setTimeout(() => {
          window.location.href = '/?offline=true'
        }, 2000)
      } else {
        // Fallback - vai para página principal
        window.location.href = '/'
      }
    }
    
    // === SERVICE WORKER COMMUNICATION ===
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.addEventListener('message', event => {
        const { action, data } = event.data
        
        if (action === 'CACHED_EVENTS_FOUND') {
          // Redireciona para página com dados cached
          window.location.href = `/?cached=true&events=${data.length}`
        } else if (action === 'NO_CACHED_DATA') {
          // Informa que não há dados cached
          alert('Nenhum evento foi salvo para visualização offline.')
        }
      })
    }
    
    // === ANIMAÇÃO DE SPIN ===
    const style = document.createElement('style')
    style.textContent = `
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    `
    document.head.appendChild(style)
    
    // === ATALHOS DE TECLADO ===
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        tryReconnect()
      } else if (e.key === 'Escape') {
        goOfflineMode()
      }
    })
    
    // === AUTO RETRY ===
    let retryCount = 0
    const maxRetries = 3
    
    function autoRetry() {
      if (navigator.onLine && retryCount < maxRetries) {
        retryCount++
        setTimeout(() => {
          tryReconnect()
        }, 1000 * retryCount) // Delay progressivo
      }
    }
    
    // Tenta reconectar automaticamente quando volta online
    window.addEventListener('online', () => {
      setTimeout(autoRetry, 500)
    })
  </script>
</body>
</html>